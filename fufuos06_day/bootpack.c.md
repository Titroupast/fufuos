# `bootpack.c` 文件解析

`bootpack.c` 是您操作系统的C语言主入口。在汇编语言引导程序完成初始化后，控制权会交接给这个文件中的 `HariMain` 函数。它的核心职责是初始化所有关键的系统组件，然后进入一个主循环以等待事件。

## 主要功能

### 1. 系统初始化
`HariMain` 函数首先调用一系列初始化函数，这些是操作系统正常运行的基础：
- **`init_gdtidt()`**: 设置全局描述符表 (GDT) 和中断描述符表 (IDT)。这两个表是内存分段管理和中断处理机制的基石，定义了CPU如何访问内存以及如何响应中断和异常。
- **`init_pic()`**: 初始化可编程中断控制器 (PIC)。PIC 负责管理来自键盘、鼠标等硬件设备的中断请求，该函数配置 PIC 以便正确地将这些中断路由给 CPU。
- **`io_sti()`**: 在 IDT 和 PIC 初始化完成后，这个函数会开启 CPU 的中断总开关。这使得 CPU 可以开始响应外部硬件事件。

### 2. 图形与界面设置
核心硬件配置完成后，`HariMain` 开始设置图形环境：
- **`init_palette()`**: 初始化系统将要使用的16色调色板。
- **`init_screen8()`**: 绘制初始的桌面背景、任务栏等基本UI元素。
- **鼠标指针**: 计算屏幕中心坐标，使用 `init_mouse_cursor8` 准备鼠标指针的图像数据，然后通过 `putblock8_8` 将其显示在屏幕中央。
- **信息显示**: 使用 `sprintf` 和 `putfonts8_asc` 在屏幕左上角显示鼠标的初始坐标 `(mx, my)`。

### 3. 启用外设中断
在系统能够响应中断后，`HariMain` 显式地在 PIC 的中断屏蔽寄存器 (IMR) 中取消对键盘和鼠标中断的屏蔽。这使得操作系统可以接收到按键或鼠标移动的通知。
- `io_out8(PIC0_IMR, 0xf9);` 启用键盘中断 (IRQ1)。
- `io_out8(PIC1_IMR, 0xef);` 启用鼠标中断 (IRQ12)。

### 4. 主循环 (空闲循环)
最后，函数进入一个无限循环：
```c
for (;;) {
    io_hlt();
}
```
`io_hlt()` 指令会使 CPU 停机（halt），进入一种低功耗状态。CPU 会一直保持停机，直到下一个硬件中断（例如键盘或鼠标中断）发生。当一个中断到达时，CPU 会被唤醒，执行相应的中断处理程序，处理程序结束后，CPU 会返回到这个循环中，然后再次停机。这是一个简单而高效的事件驱动模型，因为它避免了在一个空循环中浪费CPU周期。
