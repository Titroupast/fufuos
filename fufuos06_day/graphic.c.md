# `graphic.c` 文件解析

`graphic.c` 文件包含了所有与屏幕图形绘制相关的函数。它为在 8 位、256 色的图形模式下渲染 UI 元素、文本和鼠标指针提供了一套基础的工具。

## 关键函数

### `init_palette()` 和 `set_palette()`
-   `init_palette` 定义了一个静态数组 `table_rgb`，其中包含了 16 种标准的 VGA 颜色。然后它调用 `set_palette` 将这些颜色加载到显卡的硬件调色板中。
-   `set_palette` 是一个与显卡直接通信的底层函数。它首先关闭中断，以确保颜色数据在传输过程中不被打断。它通过 I/O 端口 `0x03c8` 和 `0x03c9` 依次写入每种颜色的 RGB 值。由于硬件调色板每个颜色通道只接受 6 位数据（0-63），因此代码将 0-255 范围的 RGB 值除以 4 进行转换。

### `boxfill8()`
这是一个基础的绘图函数。它通过遍历指定的坐标范围，并将一个颜色值 `c` 直接写入显存 (`vram`) 中的相应位置，从而在屏幕上绘制一个实心矩形。

### `init_screen8()`
该函数多次使用 `boxfill8` 来绘制初始的桌面用户界面。它创建了：
-   一个暗青色的背景。
-   一个位于屏幕底部的灰色“任务栏”。
-   在任务栏上绘制了具有3D效果边框的方块，模拟“开始”按钮和状态区域。

### `putfont8()` 和 `putfonts8_asc()`
-   `putfont8` 负责在屏幕上渲染一个 8x16 像素的字符。它从一个 `font` 缓冲区中读取字符的点阵数据。缓冲区中的每个字节代表了 8 个像素的一行。函数检查每一位，如果位被设置，就在对应位置绘制一个指定颜色 `c` 的像素。
-   `putfonts8_asc` 负责渲染一个以 `0x00` 结尾的字符串。它逐个字符地遍历字符串，并为每个字符调用 `putfont8`。它使用了一个外部字符数组 `hankaku`，该数组包含了所有 ASCII 字符的点阵数据。

### `init_mouse_cursor8()`
这个函数用于准备一个 16x16 像素的鼠标指针图像。它接受一个简单的字符模板，其中 `*` 代表黑色, `O` 代表白色, `.` 代表背景色（透明）。函数将这个模板转换成实际的颜色值，并存储在 `mouse` 缓冲区中，以便后续绘制到屏幕上。

### `putblock8_8()`
这是一个通用的“位块传输”(blit) 函数。它将一块矩形像素区域从一个源缓冲区 (`buf`) 复制到屏幕 (`vram`) 上的指定位置。这是一个非常灵活的函数，在这里被用来绘制鼠标指针，但它同样可以用来绘制窗口、图标或其他任何位图图像。
